<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>InstaPlay 🎮</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --card-bg: rgba(0,0,0,.6);
      --accent1:#ff416c; --accent2:#ff4b2b;
      --btn1:#36d1dc; --btn2:#5b86e5;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:"Tajawal",sans-serif;color:#fff;
      background:linear-gradient(-45deg,#f9ce34,#ee2a7b,#6228d7,#f9ce34);
      background-size:400% 400%;animation:gradientMove 12s ease infinite;
      min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:16px 12px;
    }
    @keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

    .card{
      width:100%;max-width:460px;margin:10px auto;padding:18px;border-radius:18px;
      background:var(--card-bg);backdrop-filter:blur(12px);
      box-shadow:0 12px 35px rgba(0,0,0,.55);animation:fadeIn .5s ease;
    }
    h1,h2,h3{margin:0 0 14px;text-align:center;text-shadow:0 0 6px #000}
    input,select,button{width:100%;margin:6px 0;padding:12px;border:none;border-radius:12px;font-size:15px}
    input,select{background:#fff;color:#333}
    button{cursor:pointer;font-weight:700;color:#fff;background:linear-gradient(45deg,var(--accent1),var(--accent2));transition:.25s}
    button:hover{transform:translateY(-2px) scale(1.03)}
    .subbtn{background:linear-gradient(45deg,var(--btn1),var(--btn2));}
    .danger{background:#e74c3c}
    .ghost{background:rgba(255,255,255,.1);color:#fff}
    .hidden{display:none!important}

    .games-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:8px}
    .game-btn{padding:14px;border-radius:12px;text-align:center;font-weight:700;cursor:pointer;background:linear-gradient(45deg,var(--btn1),var(--btn2))}
    .game-btn:hover{transform:scale(1.05);box-shadow:0 0 14px rgba(255,255,255,.45)}

    table{width:100%;border-collapse:collapse;background:rgba(255,255,255,.07);margin-top:10px;border-radius:12px;overflow:hidden}
    th,td{padding:8px;border:1px solid rgba(255,255,255,.2);font-size:13px;text-align:center}
    th{background:rgba(0,0,0,.35)}
    .muted{opacity:.9;font-size:13px}

    .topbar{
      position:fixed;top:6px;left:0;right:0;display:flex;justify-content:center;z-index:999;
      padding:0 10px;
    }
    .music-btn{max-width:460px;width:calc(100% - 24px);border-radius:12px;padding:8px;font-size:14px}

    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-5px)}50%{transform:translateX(5px)}75%{transform:translateX(-5px)}100%{transform:translateX(0)}}
    @keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-12px)}60%{transform:translateY(-6px)}}
    .lose-anim{animation:shake .45s}
    .win-anim{animation:bounce .9s}

    /* Mobile fine-tune */
    @media(max-width:600px){
      .card{padding:16px}
      .games-grid{grid-template-columns:1fr}
      input,select,button{font-size:15px}
    }
  </style>
</head>
<body>

  <!-- 🎵 Top Music toggle -->
  <div class="topbar">
    <button class="music-btn ghost" onclick="toggleMusic()">🎵 Music</button>
  </div>
  <audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2023/03/15/audio_4d7fa0c7b6.mp3?filename=retro-game-music-142152.mp3" loop></audio>

  <!-- 🔊 SFX -->
  <audio id="sfxWin"  src="https://assets.mixkit.co/sfx/download/mixkit-achievement-bell-600.mp3"></audio>
  <audio id="sfxLose" src="https://assets.mixkit.co/sfx/download/mixkit-player-losing-or-failing-2042.mp3"></audio>
  <audio id="sfxTap"  src="https://assets.mixkit.co/sfx/download/mixkit-fast-small-sweep-transition-166.mp3"></audio>

  <!-- 🌈 Landing -->
  <div id="landing" class="card">
    <h1>🎮 Welcome to InstaPlay</h1>
    <button onclick="show('auth')">🚀 Get Started</button>
  </div>

  <!-- 🎁 عروض -->
  <div class="card" id="offers">
    <h2>🎁 عروض حصرية</h2>
    <ul style="list-style:none;margin:0;padding:0;text-align:center;line-height:1.9">
      <li>💎 100% Bonus على أول إيداع</li>
      <li>🔥 عروض أسبوعية للاعبين النشيطين</li>
      <li>🏆 جوائز إضافية كل شهر</li>
    </ul>
  </div>

  <!-- 👥 من نحن -->
  <div class="card" id="about">
    <h2>👥 من نحن</h2>
    <p class="muted" style="text-align:center">
      InstaPlay منصة ألعاب تجمع بين المتعة والمكافآت مع تجربة آمنة وسهلة للجميع.
    </p>
  </div>

  <!-- 🔐 Auth -->
  <div id="auth" class="card hidden">
    <h1>🎮 InstaPlay</h1>
    <input id="name"  type="text"     placeholder="Full name">
    <input id="email" type="email"    placeholder="Email">
    <input id="pass"  type="password" placeholder="Password">
    <button onclick="register()">Register</button>
    <button class="ghost" onclick="login()">Login</button>
    <button class="subbtn" onclick="show('adminLogin')">👑 Admin Login</button>
  </div>

  <!-- 👑 Admin Login -->
  <div id="adminLogin" class="card hidden">
    <h2>👑 Admin Login</h2>
    <input id="adminEmail" type="email" placeholder="Email">
    <input id="adminPass"  type="password" placeholder="Password">
    <button onclick="adminLogin()">Login</button>
    <button class="ghost" onclick="show('auth')">⬅️ Back</button>
  </div>

  <!-- 👑 Admin Panel -->
  <div id="adminPanel" class="card hidden">
    <h2>👑 Admin Panel</h2>
    <div style="display:flex;gap:8px">
      <input id="searchId" class="flex1" type="text" placeholder="Search by ID (e.g. UID12345)">
      <button class="subbtn" onclick="searchUserById()">🔍 Search</button>
    </div>
    <div id="searchResult" class="muted" style="margin-top:6px">—</div>
    <table id="usersTable">
      <thead>
        <tr><th>Name</th><th>ID</th><th>Balance</th><th>Losses</th><th>Edit</th><th>Mode</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button class="ghost" onclick="location.reload()">🔄 Refresh</button>
      <button class="danger" style="flex:1" onclick="logout()">🚪 Logout</button>
    </div>
  </div>

  <!-- 🎮 Dashboard -->
  <div id="dashboard" class="card hidden">
    <h2>Welcome <span id="userName"></span></h2>
    <p class="muted">ID: <span id="userId"></span></p>
    <p>💰 Balance: <b><span id="balance">0</span> $</b></p>

    <select id="betAmount">
      <option value="5">5$</option>
      <option value="10">10$</option>
      <option value="20">20$</option>
      <option value="50">50$</option>
    </select>

    <h3>💳 عمليات</h3>
    <div style="display:flex;gap:8px">
      <button class="subbtn" onclick="deposit(10)">➕ إيداع 10$</button>
      <button class="ghost"  onclick="withdraw(10)">➖ سحب 10$</button>
    </div>
    <div id="history" class="muted" style="margin-top:8px"></div>

    <div class="games-grid">
      <div class="game-btn" onclick="show('rpsGame')">✊✋✌️ RPS</div>
      <div class="game-btn" onclick="show('slotGame')">🎰 Slot</div>
      <div class="game-btn" onclick="startMines()">💣 Mines</div>
    </div>

    <button class="danger" style="margin-top:10px" onclick="logout()">🚪 Logout</button>
  </div>

  <!-- ✊✋✌️ RPS -->
  <div id="rpsGame" class="card hidden">
    <h2>✊✋✌️ RPS</h2>
    <div style="display:flex;gap:8px">
      <button onclick="playRPS('✊')">✊</button>
      <button onclick="playRPS('✋')">✋</button>
      <button onclick="playRPS('✌️')">✌️</button>
    </div>
    <p>أنت: <span id="playerChoice"></span></p>
    <p>الكمبيوتر: <span id="computerChoice"></span></p>
    <p id="rpsResult" class="muted"></p>
    <button class="ghost" onclick="show('dashboard')">⬅️ Back</button>
  </div>

  <!-- 🎰 Slot -->
  <div id="slotGame" class="card hidden">
    <h2>🎰 Slot</h2>
    <button onclick="playSlot()">▶️ Spin</button>
    <p id="slotResult" class="muted"></p>
    <button class="ghost" onclick="show('dashboard')">⬅️ Back</button>
  </div>

  <!-- 💣 Mines -->
  <div id="minesGame" class="card hidden">
    <h2>💣 Mines</h2>
    <div id="minesGrid" style="display:grid;grid-template-columns:repeat(5,56px);gap:10px;justify-content:center;margin:12px 0;"></div>
    <p id="minesResult" class="muted"></p>
    <div style="display:flex;gap:8px">
      <button class="subbtn" onclick="cashoutMines()">💵 Cashout</button>
      <button class="ghost"  onclick="resetMines()">🔄 Reset</button>
      <button class="ghost"  onclick="show('dashboard')">⬅️ Back</button>
    </div>
  </div>

<script>
/* ===================== Core State ===================== */
const ADMIN_EMAIL="special@gmail.com";
const ADMIN_PASS ="special123";
let currentUser=null;

/* ===================== Utils ===================== */
function show(id){
  document.querySelectorAll(".card").forEach(c=>c.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  // keep top sections visible only on landing/auth
  const base = ["landing","offers","about"];
  if(id==="auth"||id==="landing"){ base.forEach(x=>document.getElementById(x)?.classList.remove("hidden")); }
  else { base.forEach(x=>document.getElementById(x)?.classList.add("hidden")); }
}

function uid(){ return "UID"+Math.floor(Math.random()*99999); }
function playS(id){ const a=document.getElementById(id); a.currentTime=0; a.play().catch(()=>{}); }
function toggleMusic(){ const m=document.getElementById("bgMusic"); (m.paused?m.play():m.pause()).catch(()=>{}); }

function saveUser(u){ localStorage.setItem("user_"+u.email, JSON.stringify(u)); renderUsers(); }
function loadUser(email){ const raw = localStorage.getItem("user_"+email); if(!raw) return null;
  const u = JSON.parse(raw);
  // ensure fields exist for old users
  if(typeof u.losses!=="number") u.losses=0;
  if(!Array.isArray(u.history)) u.history=[];
  if(!u.mode) u.mode="normal";
  return u;
}
function allUsers(){
  const arr=[];
  for(let i=0;i<localStorage.length;i++){
    const k=localStorage.key(i);
    if(k.startsWith("user_")){ try{ arr.push(JSON.parse(localStorage.getItem(k))); }catch{} }
  }
  return arr;
}
function getBet(){
  const v = parseInt(document.getElementById("betAmount").value,10);
  if(!currentUser) return null;
  if(currentUser.balance < v){ alert("Not enough balance"); return null; }
  return v;
}
function forceResult(){ return currentUser?.mode || "normal"; }
function updateUI(){
  if(!currentUser) return;
  document.getElementById("userName").textContent=currentUser.name;
  document.getElementById("userId").textContent=currentUser.id;
  document.getElementById("balance").textContent=currentUser.balance;
  saveUser(currentUser);
  showHistory();
}

/* Auto-sync player view when admin edits from another tab/device */
setInterval(()=> {
  if(!currentUser) return;
  const fresh = loadUser(currentUser.email);
  if(!fresh) return;
  if(fresh.balance!==currentUser.balance || fresh.mode!==currentUser.mode || fresh.losses!==currentUser.losses || (fresh.history||[]).length!== (currentUser.history||[]).length){
    currentUser = fresh;
    updateUI();
  }
}, 1500);

/* ===================== Auth ===================== */
function register(){
  const name = document.getElementById("name").value.trim();
  const email= document.getElementById("email").value.trim();
  const pass = document.getElementById("pass").value;
  if(!name||!email||!pass){ alert("Fill all fields"); return; }
  if(loadUser(email)){ alert("Account exists"); return; }
  const u={ name, email, password:pass, balance:20, id:uid(), mode:"normal", losses:0, history:[] };
  saveUser(u);
  alert("Registered with 20$ bonus.");
  renderUsers();
}

function login(){
  const email= document.getElementById("email").value.trim();
  const pass = document.getElementById("pass").value;
  const u = loadUser(email);
  if(!u || u.password!==pass){ alert("Invalid"); return; }
  currentUser=u; updateUI(); show("dashboard"); playS("sfxTap");
}
function logout(){ currentUser=null; show("auth"); }

/* ===================== Admin ===================== */
function adminLogin(){
  const e=document.getElementById("adminEmail").value.trim();
  const p=document.getElementById("adminPass").value;
  if(e===ADMIN_EMAIL && p===ADMIN_PASS){ show("adminPanel"); renderUsers(); }
  else alert("❌ Wrong admin login");
}

function renderUsers(){
  const tbody=document.querySelector("#usersTable tbody");
  if(!tbody) return;
  tbody.innerHTML="";
  allUsers().forEach(u=>{
    const key = btoa(u.email);
    const losses = (typeof u.losses==="number") ? u.losses : 0;
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${u.name||"-"}</td>
      <td>${u.id||"-"}</td>
      <td>${u.balance??0}</td>
      <td>${losses}$</td>
      <td style="min-width:150px">
        <input type="number" value="${u.balance??0}" id="bal_${key}" style="padding:8px;background:#fff;color:#333;border-radius:10px">
        <button class="subbtn" onclick="updateBal('${u.email}')">✔️</button>
      </td>
      <td>
        <select id="mode_${key}" onchange="changeMode('${u.email}')">
          <option value="normal" ${u.mode==="normal"?"selected":""}>⚖️ Normal</option>
          <option value="win" ${u.mode==="win"?"selected":""}>🔥 Always Win</option>
          <option value="lose" ${u.mode==="lose"?"selected":""}>❌ Always Lose</option>
        </select>
      </td>`;
    tbody.appendChild(tr);
  });
}

function updateBal(email){
  const key=btoa(email);
  const u=loadUser(email); if(!u) return;
  u.balance = parseInt(document.getElementById("bal_"+key).value,10) || 0;
  saveUser(u);
  // live update if edited current player
  if(currentUser && currentUser.email===email){ currentUser=u; updateUI(); }
}

function changeMode(email){
  const key=btoa(email);
  const u=loadUser(email); if(!u) return;
  u.mode = document.getElementById("mode_"+key).value;
  saveUser(u);
  if(currentUser && currentUser.email===email){ currentUser=u; updateUI(); }
}

function searchUserById(){
  const id = document.getElementById("searchId").value.trim();
  const found = allUsers().find(u=>u.id===id);
  document.getElementById("searchResult").innerHTML = found
    ? `👤 ${found.name} — 🆔 ${found.id} — 💰 ${found.balance}$`
    : "❌ No user";
}

/* ===================== Wallet (Deposit / Withdraw) ===================== */
function deposit(amount){
  if(!currentUser) return;
  currentUser.balance += amount;
  currentUser.history.push({type:"إيداع",amount,date:new Date().toLocaleString()});
  updateUI(); playS("sfxWin");
}

function withdraw(amount){
  if(!currentUser) return;
  if(currentUser.balance < amount){ alert("❌ رصيد غير كافي"); return; }
  currentUser.balance -= amount;
  currentUser.history.push({type:"سحب",amount,date:new Date().toLocaleString()});
  updateUI(); playS("sfxTap");
}

function showHistory(){
  const div=document.getElementById("history"); if(!div || !currentUser) return;
  if(!currentUser.history.length){ div.textContent="لا توجد عمليات بعد."; return; }
  div.innerHTML = currentUser.history.map(h=>`• ${h.date} — ${h.type} ${h.amount}$`).join("<br>");
}

/* ===================== Games ===================== */
// RPS
function playRPS(player){
  const bet = getBet(); if(!bet) return; playS("sfxTap");
  const opt=["✊","✋","✌️"]; let comp;
  const mode=forceResult();
  if(mode==="win"){ comp = (player==="✊"?"✌️": player==="✋"?"✊":"✋"); }
  else if(mode==="lose"){ comp = (player==="✊"?"✋": player==="✋"?"✌️":"✊"); }
  else { comp = opt[Math.floor(Math.random()*3)]; }

  document.getElementById("playerChoice").textContent=player;
  document.getElementById("computerChoice").textContent=comp;

  const res = document.getElementById("rpsResult"); res.className="muted";
  const win = (player==="✊"&&comp==="✌️")||(player==="✋"&&comp==="✊")||(player==="✌️"&&comp==="✋");
  if(player===comp){ res.textContent="🤝 Draw"; }
  else if(win){
    currentUser.balance += bet; playS("sfxWin");
    res.textContent="🎉 Win +"+bet; res.classList.add("win-anim");
  }else{
    currentUser.balance -= bet; currentUser.losses += bet; playS("sfxLose");
    res.textContent="❌ Lose -"+bet; res.classList.add("lose-anim");
  }
  updateUI();
}

// Slot
function playSlot(){
  const bet = getBet(); if(!bet) return; playS("sfxTap");
  const s=["🍒","🍋","⭐","🔔","7️⃣"]; let r;
  const mode=forceResult();
  if(mode==="win"){ r=["7️⃣","7️⃣","7️⃣"]; }
  else if(mode==="lose"){ r=["🍒","⭐","🔔"]; }
  else { r=[s[Math.random()*s.length|0], s[Math.random()*s.length|0], s[Math.random()*s.length|0]]; }

  const res=document.getElementById("slotResult"); res.className="muted";
  if(r[0]===r[1] && r[1]===r[2]){
    currentUser.balance += bet*5; playS("sfxWin");
    res.innerHTML = `${r.join(" ")}<br>🎉 Jackpot +${bet*5}`;
  }else if(r[0]===r[1]||r[1]===r[2]||r[0]===r[2]){
    currentUser.balance += bet; playS("sfxWin");
    res.innerHTML = `${r.join(" ")}<br>✨ Win +${bet}`;
  }else{
    currentUser.balance -= bet; currentUser.losses += bet; playS("sfxLose");
    res.innerHTML = `${r.join(" ")}<br>❌ Lose -${bet}`;
  }
  updateUI();
}

// Mines
let minesData=[], minesActive=false, minesBet=0;
function startMines(){ show("minesGame"); resetMines(); }

function resetMines(){
  const g=document.getElementById("minesGrid");
  g.innerHTML=""; minesData=[]; minesActive=true;
  minesBet = getBet(); if(!minesBet){ show('dashboard'); return; }

  for(let i=0;i<25;i++){
    const isMine = Math.random()<0.2; // 20%
    minesData.push(isMine);
    const b=document.createElement("button");
    b.textContent="❓"; b.style.width="56px"; b.style.height="56px"; b.style.fontSize="20px";
    b.onclick=()=>clickMine(i,b);
    g.appendChild(b);
  }
  document.getElementById("minesResult").textContent="اختر الخانات 🔎";
}

function clickMine(i,btn){
  if(!minesActive) return;
  const res=document.getElementById("minesResult"); res.className="muted";
  if(minesData[i]){
    btn.textContent="💣"; btn.style.background="#ff4d4d"; minesActive=false;
    currentUser.balance -= minesBet; currentUser.losses += minesBet; playS("sfxLose");
    res.textContent="❌ Boom -"+minesBet;
  }else{
    btn.textContent="💎"; btn.style.background="#36d1dc"; btn.disabled=true;
    currentUser.balance += minesBet; playS("sfxWin");
    res.textContent="🎉 Safe +"+minesBet;
  }
  updateUI();
}

function cashoutMines(){
  if(!minesActive) return;
  minesActive=false;
  const res=document.getElementById("minesResult");
  res.textContent += " — 💵 Cashed out";
}

/* ===================== Init ===================== */
renderUsers(); // in case admin screen opened بعد التحميل
</script>
</body>
</html>
