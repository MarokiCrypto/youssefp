<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>InstaPlay 🎮</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{margin:0;font-family:"Tajawal",sans-serif;
      background:linear-gradient(-45deg,#f9ce34,#ee2a7b,#6228d7,#f9ce34);
      background-size:400% 400%;animation:gradientMove 12s ease infinite;
      color:white;min-height:100vh;display:flex;justify-content:center;align-items:flex-start;padding:20px;}
    @keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .card{background:rgba(0,0,0,0.6);padding:20px;border-radius:18px;width:460px;max-width:95%;box-shadow:0 10px 30px rgba(0,0,0,0.5);margin:10px auto;}
    h1,h2,h3{margin:0 0 15px;text-align:center;}
    input,button,select{width:100%;margin:6px 0;padding:12px;border:none;border-radius:10px;font-size:15px;}
    input,select{background:#fff;color:#333}
    button{cursor:pointer;font-weight:bold;background:white;color:#6228d7;transition:.3s}
    button:hover{background:#ee2a7b;color:white;transform:scale(1.05)}
    .hidden{display:none}
    .games-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
    .game-btn{background:#fff;color:#6228d7;padding:14px;border-radius:10px;font-weight:bold;cursor:pointer}
    .game-btn:hover{background:#f9ce34;color:#000}
  </style>
</head>
<body>

<!-- 🔐 Auth -->
<div id="auth" class="card">
  <h1>🎮 InstaPlay</h1>
  <h3>Login / Register</h3>
  <input id="name" type="text" placeholder="Full name">
  <input id="email" type="text" placeholder="Email">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="register()">Register</button>
  <button onclick="login()">Login</button>
</div>

<!-- 🎮 Dashboard -->
<div id="dashboard" class="card hidden">
  <h2>Welcome <span id="userName"></span></h2>
  <p>ID: <span id="userId"></span></p>
  <p>💰 Balance: <span id="balance"></span> $</p>
  <select id="betAmount">
    <option value="5">5$</option>
    <option value="10">10$</option>
    <option value="20">20$</option>
    <option value="50">50$</option>
  </select>
  <div class="games-grid">
    <div class="game-btn" onclick="hideAll();show('coinGame')">🪙 Coin</div>
    <div class="game-btn" onclick="hideAll();show('diceGame')">🎲 Dice</div>
    <div class="game-btn" onclick="hideAll();show('rpsGame')">✊✋✌️ RPS</div>
    <div class="game-btn" onclick="hideAll();show('slotGame')">🎰 Slot</div>
    <div class="game-btn" onclick="startMines()">💣 Mines</div>
  </div>
  <button onclick="logout()">🚪 Logout</button>
</div>

<!-- Games -->
<div id="coinGame" class="card hidden"><h2>🪙 Coin Toss</h2><div id="coin" style="font-size:100px;transition:transform 1s;">🪙</div><button onclick="flipCoin('Heads')">Heads</button><button onclick="flipCoin('Tails')">Tails</button><p id="coinResult"></p><button onclick="backToDash()">⬅️ Back</button></div>
<div id="diceGame" class="card hidden"><h2>🎲 Dice</h2><div id="dice" style="font-size:100px;margin:15px;">🎲</div><button onclick="rollDice()">🎲 Roll</button><p id="diceResult"></p><button onclick="backToDash()">⬅️ Back</button></div>
<div id="rpsGame" class="card hidden"><h2>✊✋✌️ Rock Paper Scissors</h2><div style="display:flex;justify-content:space-around;font-size:60px;margin:15px 0;"><button onclick="playRPS('✊')">✊</button><button onclick="playRPS('✋')">✋</button><button onclick="playRPS('✌️')">✌️</button></div><div id="rpsBattle" style="display:flex;justify-content:space-around;font-size:40px;margin:20px 0;opacity:0;transition:opacity .5s;"><div>👤 <span id="playerChoice">❓</span></div><div>VS</div><div>🤖 <span id="computerChoice">❓</span></div></div><p id="rpsResult"></p><button onclick="backToDash()">⬅️ Back</button></div>
<div id="slotGame" class="card hidden"><h2>🎰 Slot Machine</h2><div id="slotReels" style="display:flex;justify-content:center;font-size:50px;gap:20px;margin:15px 0;"><span id="reel1">❓</span><span id="reel2">❓</span><span id="reel3">❓</span></div><button onclick="playSlot()">▶️ Spin</button><p id="slotResult"></p><button onclick="backToDash()">⬅️ Back</button></div>
<div id="minesGame" class="card hidden"><h2>💣 Mines</h2><div id="minesGrid" style="display:grid;grid-template-columns:repeat(5,60px);gap:10px;justify-content:center;margin:15px 0;"></div><p id="minesResult"></p><button onclick="resetMines()">🔄 Reset</button><button onclick="backToDash()">⬅️ Back</button></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCZyhjRpweWJVqwccKBRkWbDLhm8GGoywI",
  authDomain: "instaplay-421f2.firebaseapp.com",
  projectId: "instaplay-421f2",
  storageBucket: "instaplay-421f2.appspot.com",
  messagingSenderId: "888236671599",
  appId: "1:888236671599:web:67bec209771e43b4f6039a",
  measurementId: "G-RXHP314NRG"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentUser=null;

function hideAll(){document.querySelectorAll(".card").forEach(c=>c.classList.add("hidden"));}
function show(id){hideAll();document.getElementById(id).classList.remove("hidden");}
function backToDash(){hideAll();show("dashboard");}
function backToAuth(){hideAll();show("auth");}

/* Register / Login */
async function register(){
  let name=document.getElementById("name").value;
  let email=document.getElementById("email").value;
  let pass=document.getElementById("pass").value;
  if(!name||!email||!pass){alert("Fill all fields");return;}
  const userId=email.replace(/[^a-zA-Z0-9]/g,"_");
  const userRef=doc(db,"users",userId);
  const snap=await getDoc(userRef);
  if(snap.exists()){alert("Account already exists");return;}
  await setDoc(userRef,{name,email,password:pass,balance:20,forceWin:false,forceLose:false});
  alert("Registered successfully (20$ bonus).");
}
async function login(){
  let email=document.getElementById("email").value;
  let pass=document.getElementById("pass").value;
  const userId=email.replace(/[^a-zA-Z0-9]/g,"_");
  const userRef=doc(db,"users",userId);
  const snap=await getDoc(userRef);
  if(!snap.exists()){alert("No account found");return;}
  const data=snap.data();
  if(data.password!==pass){alert("Wrong password");return;}
  currentUser={id:userId,...data};
  updateUI();show("dashboard");
}
function logout(){currentUser=null;backToAuth();}
function updateUI(){
  document.getElementById("userName").innerText=currentUser.name;
  document.getElementById("userId").innerText=currentUser.id;
  document.getElementById("balance").innerText=currentUser.balance;
}
function getBet(){
  let v=parseInt(document.getElementById("betAmount").value);
  if(currentUser.balance<v){alert("Not enough balance");return null;}
  return v;
}
async function forceResult(){
  const snap=await getDoc(doc(db,"users",currentUser.id));
  if(snap.exists()){
    let d=snap.data();
    if(d.forceWin) return "win";
    if(d.forceLose) return "lose";
  }
  return "normal";
}
async function updateBalance(newBalance){
  await updateDoc(doc(db,"users",currentUser.id),{balance:newBalance});
  currentUser.balance=newBalance;updateUI();
}

/* --- Games --- */
// Coin
async function flipCoin(choice){
  let bet=getBet();if(!bet)return;
  let mode=await forceResult();let result;
  if(mode==="win"){result=choice;}
  else if(mode==="lose"){result=(choice==="Heads"?"Tails":"Heads");}
  else{result=Math.random()<0.5?"Heads":"Tails";}
  setTimeout(async()=>{
    if(result===choice){await updateBalance(currentUser.balance+bet);document.getElementById("coinResult").innerText="🎉 Win +"+bet;}
    else{await updateBalance(currentUser.balance-bet);document.getElementById("coinResult").innerText="❌ Lose -"+bet;}
  },800);
}
// Dice
async function rollDice(){
  let bet=getBet();if(!bet)return;
  let mode=await forceResult();let r;
  if(mode==="win"){r=6;}else if(mode==="lose"){r=1;}else{r=Math.floor(Math.random()*6)+1;}
  setTimeout(async()=>{
    document.getElementById("dice").innerText=["⚀","⚁","⚂","⚃","⚄","⚅"][r-1];
    if(r>=4){await updateBalance(currentUser.balance+bet);document.getElementById("diceResult").innerText="🎉 Win";}
    else{await updateBalance(currentUser.balance-bet);document.getElementById("diceResult").innerText="❌ Lose";}
  },800);
}
// RPS
async function playRPS(player){
  let bet=getBet();if(!bet)return;
  let mode=await forceResult();let comp;
  if(mode==="win"){comp=(player==="✊"?"✌️":player==="✋"?"✊":"✋");}
  else if(mode==="lose"){comp=(player==="✊"?"✋":player==="✋"?"✌️":"✊");}
  else{comp=["✊","✋","✌️"][Math.floor(Math.random()*3)];}
  document.getElementById("playerChoice").innerText=player;
  document.getElementById("computerChoice").innerText=comp;
  document.getElementById("rpsBattle").style.opacity=1;
  if(player===comp){document.getElementById("rpsResult").innerText="🤝 Draw";}
  else if((player==="✊"&&comp==="✌️")||(player==="✋"&&comp==="✊")||(player==="✌️"&&comp==="✋")){
    await updateBalance(currentUser.balance+bet);document.getElementById("rpsResult").innerText="🎉 Win +"+bet;
  }else{
    await updateBalance(currentUser.balance-bet);document.getElementById("rpsResult").innerText="❌ Lose -"+bet;
  }
}
// Slot
async function playSlot(){
  let bet=getBet();if(!bet)return;
  let mode=await forceResult();let s=["🍒","🍋","⭐","🔔","7️⃣"];
  let reels=[document.getElementById("reel1"),document.getElementById("reel2"),document.getElementById("reel3")];
  let r;
  if(mode==="win"){r=["7️⃣","7️⃣","7️⃣"];}
  else if(mode==="lose"){r=["🍒","⭐","🔔"];}
  else{r=[s[Math.floor(Math.random()*s.length)],s[Math.floor(Math.random()*s.length)],s[Math.floor(Math.random()*s.length)]];}
  reels[0].innerText=r[0];reels[1].innerText=r[1];reels[2].innerText=r[2];
  if(r[0]===r[1]&&r[1]===r[2]){await updateBalance(currentUser.balance+bet*5);document.getElementById("slotResult").innerText="🎉 Jackpot";}
  else if(r[0]===r[1]||r[1]===r[2]||r[0]===r[2]){await updateBalance(currentUser.balance+bet);document.getElementById("slotResult").innerText="✨ Small Win";}
  else{await updateBalance(currentUser.balance-bet);document.getElementById("slotResult").innerText="❌ Lose";}
}
// Mines
let minesData=[];let minesActive=true;
function startMines(){hideAll();show("minesGame");resetMines();}
function resetMines(){
  let g=document.getElementById("minesGrid");g.innerHTML="";minesData=[];minesActive=true;
  for(let i=0;i<25;i++){
    let mine=Math.random()<0.2;minesData.push(mine);
    let b=document.createElement("button");
    b.innerText="❓";b.style.width="60px";b.style.height="60px";b.style.fontSize="22px";
    b.onclick=()=>clickMine(i,b);g.appendChild(b);
  }
}
async function clickMine(i,btn){
  if(!minesActive)return;
  let bet=getBet();if(!bet)return;
  let mode=await forceResult();
  if(mode==="lose"||minesData[i]){
    btn.innerText="💣";btn.style.background="#ff4444";minesActive=false;
    await updateBalance(currentUser.balance-bet);
    document.getElementById("minesResult").innerText="❌ Boom!";
  }else{
    btn.innerText="💎";btn.style.background="#44ff44";
    await updateBalance(currentUser.balance+bet);
    document.getElementById("minesResult").innerText="🎉 Safe!";
  }
}
</script>
</body>
</html>
