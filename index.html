<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>InstaPlay ğŸ®</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js"></script>

  <style>
    body{margin:0;font-family:"Tajawal",sans-serif;
      background:linear-gradient(-45deg,#f9ce34,#ee2a7b,#6228d7,#f9ce34);
      background-size:400% 400%;animation:gradientMove 12s ease infinite;
      color:white;min-height:100vh;display:flex;justify-content:center;align-items:flex-start;padding:20px;}
    @keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .card{background:rgba(0,0,0,0.6);padding:20px;border-radius:18px;width:460px;max-width:95%;box-shadow:0 10px 30px rgba(0,0,0,0.5);margin:10px auto;}
    h1,h2,h3{margin:0 0 15px;text-align:center;}
    input,button,select{width:100%;margin:6px 0;padding:12px;border:none;border-radius:10px;font-size:15px;}
    input,select{background:#fff;color:#333}
    button{cursor:pointer;font-weight:bold;background:white;color:#6228d7;transition:.3s}
    button:hover{background:#ee2a7b;color:white;transform:scale(1.05)}
    .hidden{display:none}
    table{width:100%;border-collapse:collapse;background:rgba(255,255,255,0.1);margin-top:10px;}
    th,td{padding:6px;border:1px solid rgba(255,255,255,0.2);font-size:13px;text-align:center}
    th{background:rgba(0,0,0,0.4)}
  </style>
</head>
<body>

<!-- ğŸ” Auth -->
<div id="auth" class="card">
  <h1>ğŸ® InstaPlay</h1>
  <h3>Login / Register</h3>
  <input id="name" type="text" placeholder="Full name">
  <input id="email" type="text" placeholder="Email">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="register()">Register</button>
  <button onclick="login()">Login</button>
  <button onclick="show('adminLogin')">ğŸ‘‘ Admin Login</button>
</div>

<!-- ğŸ‘‘ Admin Login -->
<div id="adminLogin" class="card hidden">
  <h2>ğŸ‘‘ Admin Login</h2>
  <input id="adminEmail" type="text" placeholder="Email">
  <input id="adminPass" type="password" placeholder="Password">
  <button onclick="adminLogin()">Login</button>
  <button onclick="backToAuth()">â¬…ï¸ Back</button>
</div>

<!-- ğŸ‘‘ Admin Panel -->
<div id="adminPanel" class="card hidden">
  <h2>ğŸ‘‘ Admin Panel</h2>
  <table id="usersTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>ID</th>
        <th>Balance</th>
        <th>Edit Balance</th>
        <th>Mode</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="backToAuth()">â¬…ï¸ Logout</button>
</div>

<!-- ğŸ® Dashboard -->
<div id="dashboard" class="card hidden">
  <h2>Welcome <span id="userName"></span></h2>
  <p>ID: <span id="userId"></span></p>
  <p>ğŸ’° Balance: <span id="balance"></span> $</p>
  <button onclick="logout()">ğŸšª Logout</button>
</div>

<script>
// ===================== ğŸ”¥ Firebase Setup =====================
const firebaseConfig = {
  apiKey: "XXXXXXX",              // ğŸ‘ˆ ØºÙŠØ±Ù‡Ø§ Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ
  authDomain: "instaplay-XXXX.firebaseapp.com",
  projectId: "instaplay-XXXX",
  storageBucket: "instaplay-XXXX.appspot.com",
  messagingSenderId: "XXXXXXX",
  appId: "1:XXXX:web:XXXX"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ===================== Variables =====================
const ADMIN_EMAIL="special@gmail.com";
const ADMIN_PASS="special123";
let currentUser=null;

// ===================== Helpers =====================
function hideAll(){document.querySelectorAll(".card").forEach(c=>c.classList.add("hidden"));}
function show(id){hideAll();document.getElementById(id).classList.remove("hidden");}
function backToAuth(){hideAll();show("auth");}
function updateUI(){
  document.getElementById("userName").innerText=currentUser.NAME;
  document.getElementById("userId").innerText=currentUser.id;
  document.getElementById("balance").innerText=currentUser.balance;
}

// ===================== Auth =====================
async function register(){
  let name=document.getElementById("name").value;
  let email=document.getElementById("email").value;
  let pass=document.getElementById("pass").value;
  if(!name||!email||!pass){alert("Fill all fields");return;}
  
  let id="UID"+Math.floor(Math.random()*99999);
  let u={id,NAME:name,email,password:pass,balance:20,forceWin:false,forceLose:false};
  await db.collection("users").doc(id).set(u);
  alert("Registered successfully (20$ bonus).");
}

async function login(){
  let email=document.getElementById("email").value;
  let pass=document.getElementById("pass").value;
  let snap=await db.collection("users").where("email","==",email).get();
  if(snap.empty){alert("Account not found");return;}
  let u=snap.docs[0].data();
  if(u.password!==pass){alert("Wrong password");return;}
  currentUser=u;
  updateUI();
  show("dashboard");
}

function logout(){currentUser=null;backToAuth();}

// ===================== Admin =====================
function adminLogin(){
  let email=document.getElementById("adminEmail").value;
  let pass=document.getElementById("adminPass").value;
  if(email===ADMIN_EMAIL && pass===ADMIN_PASS){show("adminPanel");renderUsers();}
  else alert("âŒ Wrong admin login");
}

async function renderUsers(){
  let tbody=document.querySelector("#usersTable tbody");
  tbody.innerHTML="";
  let snap=await db.collection("users").get();
  snap.forEach(doc=>{
    let u=doc.data();
    let tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${u.NAME}</td>
      <td>${doc.id}</td>
      <td>${u.balance}</td>
      <td>
        <input type='number' value='${u.balance}' id='bal_${doc.id}'>
        <button onclick="updateBal('${doc.id}')">âœ”ï¸</button>
      </td>
      <td>
        <select id="mode_${doc.id}" onchange="changeMode('${doc.id}')">
          <option value="normal" ${(u.forceWin===false && u.forceLose===false)?"selected":""}>âš–ï¸ Normal</option>
          <option value="win" ${u.forceWin?"selected":""}>ğŸ”¥ Always Win</option>
          <option value="lose" ${u.forceLose?"selected":""}>âŒ Always Lose</option>
        </select>
      </td>`;
    tbody.appendChild(tr);
  });
}

async function updateBal(userId){
  let newBal=parseInt(document.getElementById("bal_"+userId).value);
  await db.collection("users").doc(userId).update({balance:newBal});
  renderUsers();
}

async function changeMode(userId){
  let mode=document.getElementById("mode_"+userId).value;
  if(mode==="win"){
    await db.collection("users").doc(userId).update({forceWin:true, forceLose:false});
  }else if(mode==="lose"){
    await db.collection("users").doc(userId).update({forceWin:false, forceLose:true});
  }else{
    await db.collection("users").doc(userId).update({forceWin:false, forceLose:false});
  }
  renderUsers();
}
</script>
</body>
</html>
